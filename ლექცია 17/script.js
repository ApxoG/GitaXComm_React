// DOM рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ HTML-рЃЊрЃљрЃю
const form = document.getElementById("todoForm")         // Todo рЃцрЃЮрЃарЃЏрЃўрЃА рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃў
const input = document.getElementById("taskInput")       // рЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃерЃћрЃДрЃЋрЃљрЃюрЃўрЃА рЃЋрЃћрЃџрЃў
const list = document.getElementById("taskList")         // рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃАрЃўрЃљ
const filters = document.querySelector(".filters")      // рЃцрЃўрЃџрЃбрЃарЃћрЃЉрЃўрЃА рЃЎрЃЮрЃюрЃбрЃћрЃўрЃюрЃћрЃарЃў

/**
 * рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃўрЃюрЃљрЃ«рЃљрЃЋрЃА рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃАрЃўрЃљрЃА localStorage-рЃерЃў
 * рЃћрЃА рЃБрЃќрЃарЃБрЃюрЃЋрЃћрЃџрЃДрЃЮрЃцрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃерЃћрЃюрЃљрЃарЃЕрЃБрЃюрЃћрЃЉрЃљрЃА рЃњрЃЋрЃћрЃарЃЊрЃўрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ
 */
function saveDom() {
    localStorage.setItem("task_html", list.innerHTML)
}

/**
 * рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃбрЃЋрЃўрЃарЃЌрЃљрЃЋрЃА рЃерЃћрЃюрЃљрЃ«рЃБрЃџ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃА localStorage-рЃЊрЃљрЃю
 * рЃЌрЃБ рЃљрЃарЃљрЃцрЃћрЃарЃўрЃљ рЃерЃћрЃюрЃљрЃ«рЃБрЃџрЃў, рЃфрЃљрЃарЃўрЃћрЃџ рЃАрЃбрЃарЃўрЃюрЃњрЃА рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА
 */
function loadDom() {
    list.innerHTML = localStorage.getItem("task_html") || ""
}

// рЃњрЃЋрЃћрЃарЃЊрЃўрЃА рЃЕрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃўрЃАрЃљрЃА рЃбрЃЋрЃўрЃарЃЌрЃљрЃЋрЃА рЃерЃћрЃюрЃљрЃ«рЃБрЃџ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃА
loadDom()

// рЃцрЃЮрЃарЃЏрЃўрЃА submit рЃдрЃЮрЃюрЃўрЃАрЃФрЃўрЃћрЃЉрЃўрЃА рЃЏрЃАрЃЏрЃћрЃюрЃћрЃџрЃў (рЃљрЃ«рЃљрЃџрЃў рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА)
form.addEventListener("submit" ,(e) => {
    e.preventDefault()  // рЃцрЃЮрЃарЃЏрЃўрЃА рЃюрЃљрЃњрЃБрЃџрЃўрЃАрЃ«рЃЏрЃћрЃЋрЃў рЃЦрЃЏрЃћрЃЊрЃћрЃЉрЃўрЃА рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃљрЃфрЃўрЃџрЃћрЃЉрЃљ
    const text = input.value  // рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃА рЃЏрЃўрЃћрЃа рЃерЃћрЃДрЃЋрЃљрЃюрЃўрЃџрЃў рЃбрЃћрЃЦрЃАрЃбрЃў
    if(!text) return  // рЃЌрЃБ рЃбрЃћрЃЦрЃАрЃбрЃў рЃфрЃљрЃарЃўрЃћрЃџрЃўрЃљ, рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃгрЃДрЃЋрЃћрЃбрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљрЃА

    // рЃљрЃ«рЃљрЃџрЃў li рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА
    const li = document.createElement("li")
    // CSS рЃЎрЃџрЃљрЃАрЃћрЃЉрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ Tailwind CSS-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ
    li.className = "flex gap-4 border p-4 rounded-md min-w-[264px] justify-between items-center task" 

    // рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА HTML рЃерЃўрЃњрЃЌрЃљрЃЋрЃАрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ
    li.innerHTML = ` 
        <button  class="toggle" aria-label="Mark completed" name="check mark" > РюЁ </button>
        <span class="text element title">${text}</span>
        <div class="flex gap-4">
            <button class="editBtn cursor-pointer" aria-label="Edit">РюЈ№ИЈ </button>
            <button class="deleteBtn cursor-pointer" aria-label="Delete">­ЪЌЉ№ИЈ </button>
        </div>
    `
    list.appendChild(li)  // рЃљрЃ«рЃљрЃџрЃў рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃАрЃўрЃљрЃерЃў рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ
    input.value = ""      // рЃўрЃюрЃцрЃБрЃЌрЃўрЃА рЃЋрЃћрЃџрЃўрЃА рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃљ
    saveDom()             // рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ localStorage-рЃерЃў
})

// рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃАрЃўрЃўрЃА click рЃдрЃЮрЃюрЃўрЃАрЃФрЃўрЃћрЃЉрЃўрЃА рЃЏрЃАрЃЏрЃћрЃюрЃћрЃџрЃў (Event Delegation-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ)
list.addEventListener("click", (e) => {
    // рЃБрЃљрЃ«рЃџрЃЮрЃћрЃАрЃў li рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃўрЃА рЃърЃЮрЃЋрЃюрЃљ task рЃЎрЃџрЃљрЃАрЃўрЃЌ
    const li = e.target.closest("li.task")
    
    // рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃгрЃљрЃерЃџрЃўрЃА рЃдрЃўрЃџрЃљрЃЎрЃќрЃћ рЃЊрЃљрЃгрЃЎрЃљрЃърЃБрЃюрЃћрЃЉрЃљ
    if(e.target.classList.contains("deleteBtn")) {
        li.remove()  // рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃўрЃА рЃгрЃљрЃерЃџрЃљ DOM-рЃЊрЃљрЃю
        saveDom()    // рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ
    }
    
    // рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃарЃћрЃЊрЃљрЃЦрЃбрЃўрЃарЃћрЃЉрЃўрЃА рЃдрЃўрЃџрЃљрЃЎрЃќрЃћ рЃЊрЃљрЃгрЃЎрЃљрЃърЃБрЃюрЃћрЃЉрЃљ
    if(e.target.classList.contains("editBtn")) {
        const span = li.querySelector(".title")  // рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃў
        // рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃџрЃўрЃАрЃњрЃљрЃю рЃљрЃ«рЃљрЃџрЃў рЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ prompt-рЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ
        const next = prompt("edit task:", span.textContent)
        // рЃЌрЃБ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃЏрЃљ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃљ рЃљрЃ«рЃљрЃџрЃў рЃбрЃћрЃЦрЃАрЃбрЃў рЃЊрЃљ рЃўрЃА рЃњрЃљрЃюрЃАрЃ«рЃЋрЃљрЃЋрЃћрЃЉрЃБрЃџрЃўрЃљ
        if (next !== null && next !== span.textContent) {
            console.log(next)
            span.textContent = next  // рЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃљ
            saveDom()                // рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ
        }
    }

    // рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃўрЃА рЃдрЃўрЃџрЃљрЃЎрЃќрЃћ рЃЊрЃљрЃгрЃЎрЃљрЃърЃБрЃюрЃћрЃЉрЃљ
    if(e.target.classList.contains("toggle")) {
        // "completed" рЃЎрЃџрЃљрЃАрЃўрЃА рЃЕрЃљрЃарЃЌрЃЋрЃљ/рЃњрЃљрЃЏрЃЮрЃарЃЌрЃЋрЃљ
        li.classList.toggle("completed" , e.target.checked)
        saveDom()  // рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ
    }
})


// рЃцрЃўрЃџрЃбрЃарЃћрЃЉрЃўрЃА рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃўрЃА click рЃдрЃЮрЃюрЃўрЃАрЃФрЃўрЃћрЃЉрЃўрЃА рЃЏрЃАрЃЏрЃћрЃюрЃћрЃџрЃў
filters.addEventListener("click", (e) => {
    // рЃБрЃљрЃ«рЃџрЃЮрЃћрЃАрЃў button рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃўрЃА рЃърЃЮрЃЋрЃюрЃљ data-filter рЃљрЃбрЃарЃўрЃЉрЃБрЃбрЃўрЃЌ
    const btn = e.target.closest("button[data-filter]")
    
    // рЃДрЃЋрЃћрЃџрЃљ рЃцрЃўрЃџрЃбрЃарЃўрЃА рЃдрЃўрЃџрЃљрЃЎрЃўрЃАрЃЌрЃЋрЃўрЃА aria-pressed рЃљрЃбрЃарЃўрЃЉрЃБрЃбрЃўрЃА false-рЃќрЃћ рЃЊрЃљрЃДрЃћрЃюрЃћрЃЉрЃљ
    filters.querySelectorAll("button").forEach(b =>b.setAttribute("aria-pressed", "false"))
    // рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ рЃдрЃўрЃџрЃљрЃЎрЃўрЃАрЃЌрЃЋрЃўрЃА aria-pressed рЃљрЃбрЃарЃўрЃЉрЃБрЃбрЃўрЃА true-рЃќрЃћ рЃЊрЃљрЃДрЃћрЃюрЃћрЃЉрЃљ
    btn.setAttribute("aria-pressed", "true")
    
    // рЃцрЃўрЃџрЃбрЃарЃўрЃА рЃарЃћрЃЪрЃўрЃЏрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ data-filter рЃљрЃбрЃарЃўрЃЉрЃБрЃбрЃўрЃЊрЃљрЃю
    const mode = btn.dataset.filter
    
    // рЃДрЃЋрЃћрЃџрЃљ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃњрЃљрЃЊрЃљрЃарЃЉрЃћрЃюрЃљ рЃЊрЃљ рЃцрЃўрЃџрЃбрЃарЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљ
    for (const li of list.children) {
        // рЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА рЃљрЃарЃўрЃА рЃЌрЃБ рЃљрЃарЃљ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃљ рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃБрЃџрЃў
        const done = li.classList.contains("completed")
        
        // рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃўрЃА рЃЕрЃЋрЃћрЃюрЃћрЃЉрЃўрЃА/рЃЊрЃљрЃЏрЃљрЃџрЃЋрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ рЃцрЃўрЃџрЃбрЃарЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ:
        // - "all": рЃДрЃЋрЃћрЃџрЃљ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃљ рЃЕрЃљрЃюрЃА
        // - "active": рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃљрЃарЃљрЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃБрЃџрЃў рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃў рЃЕрЃљрЃюрЃА
        // - "completed": рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃБрЃџрЃў рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃў рЃЕрЃљрЃюрЃА
        li.style.display = 
        mode === "all" ? "" : 
        mode === "active" ? (done ? "none" : ""):
        mode === "completed" ? (done ? "" : "none"): ""
    }
})